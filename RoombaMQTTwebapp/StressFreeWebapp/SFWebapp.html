<!DOCTYPE html>
<html>
<title>StressFreeIoT</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif;}
body, html {
    height: 100%;
    color: #777;
    line-height: 1.8;
}

hr { background-color: red; height: 1px; border: 0; }

/* Create a Parallax Effect */
.bgimg-1, .bgimg-2, .bgimg-3 {
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}

/* First image (Logo. Full height) */
.bgimg-1 {
    background-image: url('https://cdn-images-1.medium.com/max/1503/1*lVfJFrxmv5WYXnfm7Tbf3A.png');
    min-height: 80%;
}

/* Second image (Control) */
.bgimg-2 {
    background-image: url("https://fortiguard.com/static/images/icons/app-control.svg?v=5");
    min-height: 400px;
}

.w3-wide {letter-spacing: 10px;}
.w3-hover-opacity {cursor: pointer;}

/* Turn off parallax scrolling for tablets and phones */
@media only screen and (max-device-width: 1024px) {
    .bgimg-1, .bgimg-2 {
        background-attachment: scroll;
    }
}
</style>
<body onload="initVars();">

<!-- Navbar (sit on top) -->
<div class="w3-top">
  <div class="w3-bar" id="myNavbar">
    <a class="w3-bar-item w3-button w3-hover-black w3-hide-medium w3-hide-large w3-right" href="javascript:void(0);" onclick="toggleFunction()" title="Toggle Navigation Menu">
      <i class="fa fa-bars"></i>
    </a>
    <a href="#home" class="w3-bar-item w3-button">HOME</a>
    <a href="#about" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-user"></i> ABOUT</a>
    <a href="#control" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-th"></i> CONTROL</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-right w3-hover-red">
    </a>
  </div>

  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium">
    <a href="#about" class="w3-bar-item w3-button" onclick="toggleFunction()">ABOUT</a>
    <a href="#control" class="w3-bar-item w3-button" onclick="toggleFunction()">CONTROL</a>
  </div>
</div>

<!-- First Parallax Image with Logo Text -->
<div class="bgimg-1 w3-display-container w3-opacity-min" id="home">
	<div class="w3-display-left" style="white-space:nowrap;">
      <span class="w3-center w3-padding-large w3-black w3-xlarge w3-wide w3-animate-opacity">STRESSFREEIOT</span>
      </div>
</div>

<!-- Container (About Section) -->
<div class="w3-content w3-container w3-padding-64" id="about">
  <h3 class="w3-center">ABOUT US</h3>
  <p class ="w3-center"> <font color ="black"> The team</p>
  <div class="w3-row">
    <div class="w3-col m6 w3-center w3-padding-large">
		<p><font color="white">-Wesley Werter</font></p>
		<p><font color="white">-Jens Wolvers</font></p>
		<p><font color="white">-Bert van Rossem</font></p>
		<p><font color="white">-Lars van Lent</font></p>
    </div>

    <!-- Hide this text on small devices -->
    <div class="w3-col m6 w3-hide-small w3-padding-large">
      <p> <font color="white">Welcome to the StressFreeIoT webapp! In this section we will supply you with a little bit of information about us, and about us as a team.
	  We are a group consisting of 4 students, working on implementing some control for a Roomba vacuum cleaner. This webapp is a step into making this work,
	  so check out the control tab and start controlling your Roomba!</font></p>
    </div>

<div class="w3-row w3-center w3-dark-grey w3-padding-16">
  <div class="w3-quarter w3-section">
    <span class="w3-xlarge">4</span><br>
	<a data-pjax="" href="https://github.com/StressFreeIOT/Roomba-IOT/graphs/contributors">Members</a>
  </div>
  <div class="w3-quarter w3-section">
    <span class="w3-xlarge">60+</span><br>
	<a data-pjax="" href="https://github.com/StressFreeIOT/Roomba-IOT/commits/master">Commits</a>
  </div>
  <div class="w3-quarter w3-section">
    <span class="w3-xlarge">9</span><br>
	<a data-pjax="" href="https://github.com/StressFreeIOT/Roomba-IOT">(Sub)Directories</a>
  </div>
  <div class="w3-quarter w3-section">
    <span class="w3-xlarge">1</span><br>
	<a data-pjax="" href="https://github.com/StressFreeIOT/Roomba-IOT/branches">Branches</a>
  </div>
</div>

<!-- Second Parallax Image with Portfolio Text -->
<div class="bgimg-2 w3-display-container w3-opacity-min">
  <div class="w3-display-middle">
    <span class="w3-xxlarge w3-text-black w3-wide">CONTROL</span>
  </div>
</div>

<!--Tab menu-->
<div class="w3-bar w3-black">
  <button class="w3-bar-item w3-button" onclick="openTab('Leds')">Leds</button>
  <button class="w3-bar-item w3-button" onclick="openTab('Pubsub')">Pubsub</button>
  <button class="w3-bar-item w3-button" onclick="openTab('TBD')">TBD</button>
</div>

<!-- Container (Control) -->
<!--Leds-->
<div id = 'Leds' class="w3-content w3-container Tab w3-padding-64">
  <h3 class="w3-center">Leds and Sensors</h3>
         <div class="w3-container">
            <input class="w3-input" type="text" placeholder="WebSocket MQTT Broker URL" id = "txt_MQTT_Broker_URL"><br>
         </div>
	<div class ="w3-cell-row">
         <div class="w3-container w3-cell">     
			<input class="w3-input" type="text" placeholder="MQTT Client ID" id="txt_MQTT_Client_ID"><br>
		 </div>
		 <div class="w3-container w3-cell">  
			<input type="button" class="w3-button w3-black" value="Connect" id="btn_Connect_to_Broker" onclick="mqtt_Connect_with_Broker();">
		 </div>
    </div>
         <div class="w3-container">
            <input class="w3-input" type="text" placeholder="MQTT topic root" id="txt_MQTT_topicroot"><br>
         </div>
		 
		 <section id="pubsub" class="panel-body">
         <h2>Publishing and subscribing</h2>
         <p>
            <input disabled type="button" class="btn btn-success" id="button1on" onclick='led("green", "1");' value=" on  " />
            <input type="button" class="btn btn-danger" disabled id="button1off" onclick='led("green", "0");' value=" off " /> &rarr; Broker &rarr;
            <font id="ledgreenO" size='6' bgcolor='grey' color='green'><b> O </b></font>
            &nbsp; &nbsp; Round-trip time = <span id="rtt1"></span> msec
         </p>
         <p>
            <input type="button" class="btn btn-success" id="button2on" onclick='led("yellow", "1");' value=" on  " />
            <input type="button" class="btn btn-danger" id="button2off" onclick='led("yellow", "0");' value=" off " /> &rarr; Broker &rarr;
            <font id="ledyellowO" size='6' bgcolor='grey' color='yellow'><b> O </b></font>
            &nbsp; &nbsp; Round-trip time = <span id="rtt2"></span> msec
         </p>
         <p>
            <input type="button" class="btn btn-success" id="button3on" onclick='led("red", "1");' value=" on " />
            <input type="button" class="btn btn-danger" id="button3off" onclick='led("red", "0");' value=" off " /> &rarr; Broker &rarr;
            <font id="ledredO" size='6' bgcolor='grey' color='red'><b> O </b></font>
            &nbsp; &nbsp; Round-trip time = <span id="rtt3"></span> msec
         </p>
         <p>
            Broker &rarr; Temperature = &nbsp;
            <textarea name="outputArea1" id="outputArea1" rows=1 cols=10 style="resize:none" onClick="this.select();" readonly="yes">???</textarea>
         </p>
         <p>
            Broker &rarr; &nbsp; &nbsp; &nbsp; Humidity = &nbsp;
            <textarea name="outputArea2" id="outputArea2" rows=1 cols=10 style="resize:none" onClick="this.select();" readonly="yes">???</textarea>
         </p>
      </section>
</div>



<!--Pubsuh-->
<div id = 'Pubsub' class="w3-content w3-container Tab w3-padding-64">
  <h3 class="w3-center">Pubsub</h3>
         <div class="w3-container">
            <input class="w3-input" type="text" placeholder="WebSocket MQTT Broker URL"><br>
         </div>
	<div class ="w3-cell-row">
         <div class="w3-container w3-cell">     
			<input class="w3-input" type="text" placeholder="MQTT Client ID"><br>
		 </div>
		 <div class="w3-container w3-cell">  
			<input type="button" class="w3-button w3-black" value="Connect" id="btn_Connect_to_Broker" onclick="mqtt_Connect_with_Broker();">
		 </div>
    </div>
         <div class="w3-container">
            <input class="w3-input" type="text" placeholder="MQTT topic root"><br>
         </div>
</div>

<!--TBD-->
<div id = 'TBD' class="w3-content w3-container Tab w3-padding-64">
  <h3 class="w3-center">TBD</h3>
         <div class="w3-container">
            <input class="w3-input" type="text" placeholder="WebSocket MQTT Broker URL"><br>
         </div>
	<div class ="w3-cell-row">
         <div class="w3-container w3-cell">     
			<input class="w3-input" type="text" placeholder="MQTT Client ID"><br>
		 </div>
		 <div class="w3-container w3-cell">  
			<input type="button" class="w3-button w3-black" value="Connect" id="btn_Connect_to_Broker" onclick="mqtt_Connect_with_Broker();">
		 </div>
    </div>
	<hr>
    <div class ="w3-cell-row">
         <div class="w3-container w3-cell">     
			<input class="w3-input" type="text" placeholder="MQTT Topic (Subscribe):"><br>
		 </div>
		 <div class="w3-container w3-cell">  
			<input type="button" class="w3-button w3-black" value="Subscribe" onclick="mqtt_Subscribe_to_Topic();">
		 </div>
    </div>
	<hr>
		<div class="w3-container">
            <input class="w3-input" type="text" placeholder="MQTT topic (Publish):"><br>
         </div>
	<div class ="w3-cell-row">
         <div class="w3-container w3-cell">     
			<input class="w3-input" type="text" placeholder="MQTT message:"><br>
		 </div>
		 <div class="w3-container w3-cell">  
			<input type="button" class="w3-button w3-black" value="Publish" onclick="mqtt_Publish_Message();">
		 </div>
    </div>
	
	<form class="form-horizontal">
         <div class="form-group">
            <label class="col-sm-2 control-label" for="txtAr_Console">Console:</label>
            <div class="col-sm-9">
               <textarea ype="textarea" class="form-control" rows="12" cols="100" id="txtAr_Console"></textarea>
            </div>
         </div>
         <div class="form-group">
            <label class="col-sm-2 control-label" for="btn_Clear_Console"></label>
            <div class="col-sm-4">
               <button type="button" id="btn_Clear_Console" class="btn btn-warning col-sm-4" onclick="clear_Console();">Clear console</button>
            </div>
         </div>
      </form>
	  
	  <section id="pubsub" class="panel-body">
         <h2>Publishing and subscribing</h2>
         <p>
            <input disabled type="button" class="btn btn-success" id="button1on" onclick='led("green", "1");' value=" on  " />
            <input type="button" class="btn btn-danger" disabled id="button1off" onclick='led("green", "0");' value=" off " /> &rarr; Broker &rarr;
            <font id="ledgreenO" size='6' bgcolor='grey' color='green'>O </font>
         </p>
         <p>
            <input type="button" class="btn btn-success" id="button2on" onclick='led("yellow", "1");' value=" on  " />
            <input type="button" class="btn btn-danger" id="button2off" onclick='led("yellow", "0");' value=" off " /> &rarr; Broker &rarr;
            <font id="ledyellowO" size='6' bgcolor='grey' color='yellow'> O </font>
         </p>
         <p>
            <input type="button" class="btn btn-success" id="button3on" onclick='led("red", "1");' value=" on  " />
            <input type="button" class="btn btn-danger" id="button3off" onclick='led("red", "0");' value=" off " /> &rarr; Broker &rarr;
            <font id="ledredO" size='6' bgcolor='grey' color='red'> O </font>
         </p>
         <p>
            Broker &rarr; Temperature = &nbsp;
            <textarea name="outputArea1" id="outputArea1" rows=1 cols=5 onClick="this.select();" readonly="yes">???</textarea>
         </p>
         <p>
            Broker &rarr; &nbsp; &nbsp; &nbsp; Humidity = &nbsp;
            <textarea name="outputArea2" id="outputArea2" rows=1 cols=5 onClick="this.select();" readonly="yes">???</textarea>
         </p>
      </section>
</div>

<!-- Footer -->
<footer class="w3-center w3-black w3-padding-64 w3-opacity w3-hover-opacity-off">
  <a href="#home" class="w3-button w3-light-grey"><i class="fa fa-arrow-up w3-margin-right"></i>To the top</a>
  <div class="w3-xlarge w3-section">
    <i class="fa fa-facebook-official w3-hover-opacity"></i>
    <i class="fa fa-instagram w3-hover-opacity"></i>
    <i class="fa fa-snapchat w3-hover-opacity"></i>
    <i class="fa fa-pinterest-p w3-hover-opacity"></i>
    <i class="fa fa-twitter w3-hover-opacity"></i>
    <i class="fa fa-linkedin w3-hover-opacity"></i>
  </div>
  <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-text-green">w3.css</a></p>
</footer>

 <script>
function openTab(Tab) {
    var i;
    var x = document.getElementsByClassName("Tab");
    for (i = 0; i < x.length; i++) {
       x[i].style.display = "none";  
    }
    document.getElementById(Tab).style.display = "block";  
}
</script>
 
<script>
// Change style of navbar on scroll
window.onscroll = function() {myFunction()};
function myFunction() {
    var navbar = document.getElementById("myNavbar");
    if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
        navbar.className = "w3-bar" + " w3-card" + " w3-animate-top" + " w3-white";
    } else {
        navbar.className = navbar.className.replace(" w3-card w3-animate-top w3-white", "");
    }
}

// Used to toggle the menu on small screens when clicking on the menu button
function toggleFunction() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>

    <script type="text/javascript">
      var WebSocket_MQTT_Broker_URL = "";
      var MQTT_Client_ID = "";
      var MQTT_Topic = "";
      var MQTT_Client = "";
      var MQTT_topic_root = "";
      var rtt1 = "??";
      var rtt2 = "??";
      var rtt3 = "??";

      function initVars() {
         console.log("initVars");
         MQTT_device = "webapp";
         MQTT_topic_root = "ESEiot/1718/WebApp";
      }

      function mqtt_Connect_with_Broker() {
         // Set variables
         WebSocket_MQTT_Broker_URL =
            document.getElementById("txt_MQTT_Broker_URL").value;
         MQTT_Client_ID =
            document.getElementById("txt_MQTT_Client_ID").value;
         MQTT_topic_root =
            document.getElementById("txt_MQTT_topicroot").value;

         // Create a MQTT Client nstance
         MQTT_Client =
            new Paho.MQTT.Client(WebSocket_MQTT_Broker_URL, MQTT_Client_ID);

         // set callback handlers
         MQTT_Client.onConnectionLost = onConnectionLost;
         MQTT_Client.onMessageArrived = onMessageArrived;

         var options = {
            // Connection attempt timeout in seconds
            timeout: 3,
            onSuccess: onConnect,
            onFailure: function(message) {
               alert("Connection to MQTT broker failed: " + message.errorMessage);
            }
         };

         MQTT_Client.connect(options);
      }

      // Called when the client connects
      function onConnect() {
         // Once a connection has been made, make a subscription.
         console.log("Connected to " + WebSocket_MQTT_Broker_URL);
         document.getElementById("btn_Connect_to_Broker").disabled = true;
         document.getElementById("txt_MQTT_Broker_URL").disabled = true;
         document.getElementById("txt_MQTT_Client_ID").disabled = true;
         // ??document.getElementById("pubsub").style.display = 'visible';
         document.getElementById("button1on").disabled = false;
         document.getElementById("button1off").disabled = false;
         document.getElementById("button2on").disabled = false;
         document.getElementById("button2off").disabled = false;
         document.getElementById("button3on").disabled = false;
         document.getElementById("button3off").disabled = false;
         MQTT_Client.subscribe("ESEiot/1718/WebApp/#");
      }

      // Called when the client loses its connection
      function onConnectionLost(responseObject) {
         if (responseObject.errorCode !== 0) {
            console.log("ERROR: connection lost with MQTT Broker: " +
               "\"" + responseObject.errorMessage + "\"");
            document.getElementById("btn_Connect_to_Broker").disabled = false;
            document.getElementById("txt_MQTT_Broker_URL").disabled = false;
            document.getElementById("txt_MQTT_Client_ID").disabled = false;
         }
      }

      // called when a message arrives
      function onMessageArrived(message) {
         console.log(
            "MQTT message recieved: " + "\"" + message.payloadString + "\"" +
            " MQTT topic: " + "\"" + message.destinationName + "\"" +
            " QoS: " + "\"" + message.qos + "\"" +
            " Retained: " + "\"" + message.retained + "\"");
         if (message.destinationName === MQTT_topic_root + "ledgreen") {
            if (message.payloadString === '1') {
               $('#ledgreenO').attr('color', 'green');
            } else {
               $('#ledgreenO').attr('color', 'grey');
            }
            rtt1 = (new Date()).getTime() - rtt1;
            document.getElementById("rtt1").innerHTML = rtt1;
         }
         if (message.destinationName === MQTT_topic_root + "ledyellow") {
            if (message.payloadString === '1') {
               $('#ledyellowO').attr('color', 'yellow');
            } else {
               $('#ledyellowO').attr('color', 'grey');
            }
            rtt2 = (new Date()).getTime() - rtt2;
            document.getElementById("rtt2").innerHTML = rtt2;
         }
         if (message.destinationName === MQTT_topic_root + "ledred") {
            if (message.payloadString === '1') {
               $('#ledredO').attr('color', 'red');
            } else {
               $('#ledredO').attr('color', 'grey');
            }
            rtt3 = (new Date()).getTime() - rtt3;
            document.getElementById("rtt3").innerHTML = rtt3;
         }
         if (message.destinationName === MQTT_topic_root + "temperature") {
            document.getElementById('outputArea1').style.border = "solid red";
            document.getElementById('outputArea1').innerHTML = message.payloadString;
            setTimeout(resetTemperatureBorder, 5000);
         }
      }

      // Document Ready Event
      $(document).ready(function() {
         //Generate Random MQTT Clinet ID
         gen_MQTT_Client_ID();
         //Set default MQTT Broker WebSocket URL
         document.getElementById("txt_MQTT_Broker_URL").value =
            "ws://broker.hivemq.com:8000/mqtt";
         document.getElementById("txt_MQTT_topicroot").value =
            "ESEiot/1718/WebApp/" + MQTT_Client_ID + "/";

         document.getElementById("button1on").disabled = true;
         document.getElementById("button1off").disabled = true;
         document.getElementById("button2on").disabled = true;
         document.getElementById("button2off").disabled = true;
         document.getElementById("button3on").disabled = true;
         document.getElementById("button3off").disabled = true;
         document.getElementById("rtt1").innerHTML = rtt1;
         document.getElementById("rtt2").innerHTML = rtt2;
         document.getElementById("rtt3").innerHTML = rtt3;
      })

      // Randomly generate Client ID
      function gen_MQTT_Client_ID() {
         document.getElementById("txt_MQTT_Client_ID").value =
            Math.floor(100000000000 + Math.random() * 900000000000);
         MQTT_Client_ID = document.getElementById("txt_MQTT_Client_ID").value;
      }

      function led(color, msg) {
         var message = new Paho.MQTT.Message(msg);
         message.destinationName = MQTT_topic_root + "led" + color;
         if (color == 'green') {
            rtt1 = (new Date()).getTime();
            message.qos = 0;
         }
         if (color == 'yellow') {
            rtt2 = (new Date()).getTime();
            message.qos = 1;
         }
         if (color == 'red') {
            rtt3 = (new Date()).getTime();
            message.qos = 2;
         }
         MQTT_Client.send(message);
         console.log(
            "MQTT message send: " + "\"" + message.payloadString + "\"" +
            " MQTT topic: " + "\"" + message.destinationName + "\"" +
            " QoS: " + "\"" + message.qos + "\"" +
            " Retained: " + "\"" + message.retained + "\"");
      }

      function resetTemperatureBorder() {
         document.getElementById('outputArea1').style.border = "";
      }
   </script>
   </body>
</html>
